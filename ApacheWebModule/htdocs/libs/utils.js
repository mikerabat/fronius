/**
 * Minified by jsDelivr using UglifyJS v3.3.22.
 * Original file: /npm/utils.js@1.0.1/index.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var urlParser=require("url"),http=require("http"),https=require("https"),util=require("util"),path=require("path"),fs=require("fs"),events=require("events"),crypto=require("crypto"),regexpMail=new RegExp("^[a-zA-Z0-9-_.]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$"),regexpUrl=new RegExp("^(http[s]?:\\/\\/(www\\.)?|ftp:\\/\\/(www\\.)?|www\\.){1}([0-9A-Za-z-\\.@:%_+~#=]+)+((\\.[a-zA-Z]{2,3})+)(/(.)*)?(\\?(.)*)?"),expressionCache={},LINK_1=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,LINK_2=/(^|[^\/])(www\.[\S]+(\b|$))/gim,EMAIL=new RegExp("[a-zA-Z0-9-_.]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}"),VERSION="1.0.1",ENCODING="utf8",UNDEFINED="undefined",STRING="string",FUNCTION="function",NUMBER="number",OBJECT="object",BOOLEAN="boolean",NEWLINE="\r\n";typeof setImmediate===UNDEFINED&&(global.setImmediate=function(t){process.nextTick(t)});var hasOwnProperty=Object.prototype.hasOwnProperty;function expression(query,params){var name=params.join(","),fn=expressionCache[query+"-"+name];fn||(fn=eval("(function("+name+"){"+(-1===query.indexOf("return")?"return ":"")+query+"})"),expressionCache[query+name]=fn);for(var values=[],i=2;i<arguments.length;i++)values.push(arguments[i]);return function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);for(e=0;e<values.length;e++)t.push(values[e]);return fn.apply(this,t)}}function AsyncTask(t,e,r,n,o){this.handlers={oncomplete:this.complete.bind(this)},this.isRunning=0,this.owner=t,this.name=e,this.fn=r,this.cb=n,this.waiting=o,this.interval=null,this.isCanceled=!1}function Async(t){this._max=0,this._count=0,this._isRunning=!1,this.owner=t,this.onComplete=[],this.tasksPending={},this.tasksWaiting={},this.tasksAll=[],this.tasksTimeout={}}exports.isEmpty=function(t){if(null===t)return!0;if(t.length&&0<t.length)return!1;if(0===t.length)return!0;for(var e in t)if(hasOwnProperty.call(t,e))return!1;return!0},exports.request=function(t,e,r,n,o,i,a){var s=urlParser.parse(t),p={},u=typeof r===OBJECT;i=i||ENCODING,"GET"!==(e=(e||"").toString().toUpperCase())&&(p["Content-Type"]="application/x-www-form-urlencoded"),u&&(p["Content-Type"]="application/json"),util._extend(p,o),p["X-Powered-By"]="utils.js v"+VERSION;var c={protocol:s.protocol,auth:s.auth,method:e,hostname:s.hostname,port:s.port,path:s.path,agent:!1,headers:p},l=function(t){n&&(t._buffer="",t.on("data",function(t){this._buffer+=t.toString(i)}),t.on("end",function(){n(null,this._buffer,t.statusCode,t.headers)})),t.resume()},f="https:"===c.protocol?https:http;try{var h="POST"===e||"PUT"===e,g=h?n?f.request(c,l):f.request(c):n?f.get(c,l):f.get(c);n&&(g.on("error",function(t){n(t,null,0,{})}),g.setTimeout(a||1e4,function(){n(new Error(exports.httpStatus(408)),null,0,{})})),h&&g.end(u?JSON.stringify(r):(r||"").toString(),i)}catch(t){return n&&n(t,null,0,{}),!1}return!0},exports.download=function(t,e,r,n,o,i){var a=urlParser.parse(t),s={};n=(n||"").toString().toUpperCase(),i=i||ENCODING,util._extend(s,r),s["X-Powered-By"]="utils.js v"+VERSION;var p={protocol:a.protocol,auth:a.auth,method:n,hostname:a.hostname,port:a.port,path:a.path,agent:!1,headers:s},u=function(t){e(null,t)},c="https:"===p.protocol?https:http;try{var l="POST"===n||"PUT"===n,f=l?e?c.request(p,u):c.request(p):e?c.get(p,u):c.get(p);e&&f.on("error",function(t){e(t,null)}),l&&f.end((o||"").toString(),ENCODING)}catch(t){return e&&e(t,null),!1}return!0},exports.send=function(t,e,r,n,o,i){"object"==typeof n&&(o=n=o);typeof e===STRING&&(e=fs.createReadStream(e,{flags:"r"}));var a="----"+Math.random().toString(16).substring(2),s={};o&&util._extend(s,o),t=path.basename(t),s["Cache-Control"]="max-age=0",s["Content-Type"]="multipart/form-data; boundary="+a,s["X-Powered-By"]="utils.js v"+VERSION;var p=urlParser.parse(r),u={protocol:p.protocol,auth:p.auth,method:i||"POST",hostname:p.hostname,port:p.port,path:p.path,agent:!1,headers:s},c=("https:"===u.protocol?https:http).request(u,function(t){n&&(t.body="",t.on("data",function(t){this.body+=t.toString(ENCODING)}),t.on("end",function(){n(null,t.body)}))});n&&c.on("error",function(t){n(t,null)});var l=NEWLINE+NEWLINE+"--"+a+NEWLINE+'Content-Disposition: form-data; name="File"; filename="'+t+'"'+NEWLINE+"Content-Type: "+utils.getContentType(path.extname(t))+NEWLINE+NEWLINE;return c.write(l),e.on("end",function(){c.end(NEWLINE+NEWLINE+"--"+a+"--")}),e.pipe(c,{end:!1}),this},exports.trim=function(r){var t=typeof r;return t===STRING?r.trim():(t!==OBJECT||Object.keys(r).forEach(function(t){var e=r[t];typeof e!==OBJECT?typeof e===STRING&&(r[t]=e.trim()):exports.trim(e)}),r)},exports.noop=function(){},exports.httpStatus=function(t,e){var r=t+": ";switch(t){case 200:return r+"OK";case 201:return r+"Created";case 202:return r+"Accepted";case 203:return r+"Non-Authoritative Information";case 204:return r+"No Content";case 205:return r+"Reset Content";case 206:return r+"Partial Content";case 300:return r+"Multiple Choices";case 301:return r+"Moved Permanently";case 302:return r+"Found";case 303:return r+"See Other";case 304:return r+"Not Modified";case 306:return r+"Switch Proxy";case 307:return r+"Temporary Redirect";case 308:return r+"Resume Incomplete";case 400:return r+"Bad Request";case 401:return r+"Unauthorized";case 402:return r+"Payment Required";case 403:return r+"Forbidden";case 404:return r+"Not Found";case 405:return r+"Method Not Allowed";case 406:return r+"Not Acceptable";case 407:return r+"Proxy Authentication Required";case 408:return r+"Request Timeout";case 409:return r+"Conflict";case 410:return r+"Gone";case 411:return r+"Length Required";case 412:return r+"Precondition Failed";case 413:return r+"Request Entity Too Large";case 414:return r+"Request-URI Too Long";case 415:return r+"Unsupported Media Type";case 416:return r+"Requested Range Not Satisfiable";case 417:return r+"Expectation Failed";case 431:return r+"Request Header Fields Too Large";case 500:return r+"Internal Server Error";case 501:return r+"Not Implemented";case 502:return r+"Bad Gateway";case 503:return r+"Service Unavailable";case 504:return r+"Gateway Timeout";case 505:return r+"HTTP Version Not Supported";case 511:return r+"Network Authentication Required"}return null},exports.extend=function(t,e,r){if(null===t||null===e)return t;if(typeof t!==OBJECT||typeof e!==OBJECT)return t;for(var n=Object.keys(e),o=n.length;o--;){var i=n[o];(r||typeof t[i]===UNDEFINED)&&(t[i]=e[i])}return t},exports.copy=function(t,e,r){if(null===t||null===e)return t;if(typeof t!==OBJECT||typeof e!==OBJECT)return t;typeof r===UNDEFINED&&(r=!0);for(var n=Object.keys(e),o=n.length;o--;){var i=n[o];typeof t[i]!==UNDEFINED&&(t[i]=e[i])}return t},exports.reduce=function(e,r){if(null===e||null===r)return e;var t=typeof r;if(r instanceof Array&&Object.keys(e).forEach(function(t){-1===r.indexOf(t)&&delete e[t]}),t===OBJECT){var n=Object.keys(r);Object.keys(e).forEach(function(t){-1===n.indexOf(t)&&delete e[t]})}return e},exports.isRelative=function(t){return!("//"===t.substring(0,2)||-1!==t.indexOf("http://")||-1!==t.indexOf("https://"))},exports.htmlEncode=function(t){var e=typeof t;return e===UNDEFINED?"":(e!==STRING&&(t=t.toString()),t.htmlEncode())},exports.htmlDecode=function(t){var e=typeof t;return e===UNDEFINED?"":(e!==STRING&&(t=t.toString()),t.htmlDecode())},exports.isStaticFile=function(t){return/\.\w{2,8}($|\?)+/g.test(t)},exports.isNullOrEmpty=function(t){return typeof t!==STRING||0===t.length},exports.parseInt=function(t,e){var r=typeof t;return r===UNDEFINED?e||0:(r!==STRING?t.toString():t).parseInt(e,10)},exports.parseFloat=function(t,e){var r=typeof t;return r===UNDEFINED?e||0:(r!==STRING?t.toString():t).parseFloat(e)},exports.isArray=function(t){return util.isArray(t)},exports.isDate=function(t){return util.isDate(t)},exports.getContentType=function(t){"."===t[0]&&(t=t.substring(1));return{ai:"application/postscript",appcache:"text/cache-manifest",avi:"video/avi",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",less:"text/css",sass:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/msword",dtd:"application/xml-dtd",eps:"application/postscript",exe:"application/octet-stream",gif:"image/gif",gzip:"application/x-gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",ifb:"text/calendar",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",m4a:"audio/mp4a-latm",m4v:"video/x-m4v",md:"text/markdown",mid:"audio/midi",midi:"audio/midi",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",mv4:"video/mv4",ogg:"application/ogg",pdf:"application/pdf",png:"image/png",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.ms-powerpoint",ps:"application/postscript",rar:"application/x-rar-compressed",rtf:"text/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",txt:"text/plain",wav:"audio/x-wav",webp:"image/webp",woff:"font/woff",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",zip:"application/zip"}[t.toLowerCase()]||"application/octet-stream"},exports.etag=function(t,e){for(var r=0,n=0;n<t.length;n++)r+=t.charCodeAt(n);return r.toString()+(e?":"+e:"")},exports.path=function(t,e){return e=e||"/",t[t.length-1]===e?t:t+e},exports.random=function(t,e){return t=t||1e5,e=e||0,Math.floor(Math.random()*(t-e+1))+e},exports.GUID=function(t){t=t||40;for(var e="",r=0;r<t/4+1;r++)e+=Math.floor(65536*Math.random()).toString(16);return e.substring(0,t)},exports.validate=function(t,e,r,n,o){typeof n===FUNCTION&&typeof o===UNDEFINED&&(o=n,n=null);var i=n;if(i instanceof builders.ErrorBuilder||(i=new builders.ErrorBuilder(o)),typeof e===STRING){var a=builders.validation(e);e=0===a.length?e.replace(/\s/g,"").split(","):a}if(typeof t!==UNDEFINED&&null!==t||(t={}),typeof r!==FUNCTION)throw new Error("Validate hasn't any method to validate properties.");for(var s=0;s<e.length;s++){var p=typeof c,u=e[s].toString(),c=(p===FUNCTION?t[u]():t[u])||"";if(p!==OBJECT){var l=r(u,c);typeof l!==UNDEFINED&&((p=typeof l)!==STRING?p!==BOOLEAN?!1===l.isValid&&i.add(u,l.error):l||i.add(u,"@"):i.add(u,l))}else i.add(exports.validate(c,e,r,i,n,o))}return i},exports.isValid=function(t,e){return{isValid:t,error:e||"@"}},exports.isEmail=function(t){return(t||"").toString().isEmail()},exports.isURL=function(t){return(t||"").toString().isURL()},exports.combine=function(){return"."+path.join.apply(this,arguments)},exports.removeDiacritics=function(t){for(var e=["á","ä","č","ď","é","ě","ť","ž","ú","ů","ü","í","ï","ô","ó","ö","š","ľ","ĺ","ý","ÿ","č","ř"],r=["a","a","c","d","e","e","t","z","u","u","u","i","i","o","o","o","s","l","l","y","y","c","r"],n=[],o=0;o<t.length;o++){var i=t[o],a=!1,s=e.indexOf(i);-1===s&&(s=e.indexOf(i.toLowerCase()),a=!0),-1!==s?(i=r[s],a&&(i=i.toUpperCase()),n.push(i)):n.push(i)}return n.join("")},Date.prototype.add=function(t,e){var r=this;switch(t){case"s":case"ss":case"second":case"seconds":return r.setSeconds(r.getSeconds()+e),r;case"m":case"mm":case"minute":case"minutes":return r.setMinutes(r.getMinutes()+e),r;case"h":case"hh":case"hour":case"hours":return r.setHours(r.getHours()+e),r;case"d":case"dd":case"day":case"days":return r.setDate(r.getDate()+e),r;case"M":case"MM":case"month":case"months":return r.setMonth(r.getMonth()+e),r;case"y":case"yyyy":case"year":case"years":return r.setFullYear(r.getFullYear()+e),r}return r},Date.prototype.format=function(t){var e=this,r=e.getHours(),n=e.getMinutes().toString(),o=e.getSeconds().toString(),i=(e.getMonth()+1).toString(),a=e.getFullYear().toString(),s=e.getDate().toString(),p="AM",u=r.toString();12<=r&&(r-=12,p="PM"),0===r&&(r=12);var c=(r=r.toString()).padLeft(2,"0"),l=u.padLeft(2,"0"),f=n.padLeft(2,"0"),h=o.padLeft(2,"0"),g=i.padLeft(2,"0"),d=s.padLeft(2,"0"),m=a.substring(2);return t.replace(/yyyy/g,a).replace(/yy/g,m).replace(/MM/g,g).replace(/M/g,i).replace(/dd/g,d).replace(/d/g,s).replace(/HH/g,l).replace(/H/g,u).replace(/hh/g,c).replace(/h/g,r).replace(/mm/g,f).replace(/m/g,n).replace(/ss/g,h).replace(/s/g,h).replace(/a/g,p)},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s]+|[\s]+$/g,"")}),String.prototype.count=function(t){for(var e=0,r=0;0<(e=this.indexOf(t,e+t.length))&&r++,0<e;);return r},String.prototype.parseDate=function(){return new Date(this.toString())},String.prototype.contains=function(t,e){var r=this.toString();if(typeof t===STRING)return-1!==r.indexOf(t);for(var n=0;n<t.length;n++){var o=-1!==r.indexOf(t[n]);if(e){if(!o)return!1}else if(o)return!0}return!!e},String.prototype.configuration=function(){for(var t=this.split("\n"),e=t.length,r={},n=0;n<e;n++){var o=t[n];if(""!==o&&"//"!==o.substring(0,2)){var i=o.indexOf(":");-1!==i&&(r[o.substring(0,i).trim()]=o.substring(i+1).trim())}}return r},String.prototype.format=function(){for(var t=this,e=0;e<arguments.length;e++){var r=new RegExp("\\{"+e+"\\}","gi");t=t.replace(r,arguments[e])}return t},String.prototype.htmlEncode=function(){return this.replace(/\&/g,"&amp;").replace(/\>/g,"&gt;").replace(/\</g,"&lt;").replace(/\"/g,"&quot;")},String.prototype.htmlDecode=function(){return this.replace(/&gt;/g,">").replace(/\&lt;/g,"<").replace(/\&quot;/g,'"').replace(/&amp;/g,"&")},String.prototype.urlEncode=function(){return encodeURIComponent(this)},String.prototype.urlDecode=function(){return decodeURIComponent(this)},String.prototype.params=function(t){var e=this.toString();if(typeof t===UNDEFINED||null===t)return e;var r=e.match(/\{[^}\n]*\}/g);if(null===r)return e;for(var n=r.length,o=0;o<n;o++){var i,a=r[o],s=!1,p=a.substring(1,a.length-1).trim(),u="",c=p.indexOf("|");if(-1!==c&&(u=p.substring(c+1,p.length).trim(),p=p.substring(0,c).trim()),"{!"===a.substring(0,2)?p=p.substring(1):s=!0,-1!==p.indexOf(".")){var l=p.split(".");2===l.length?i=t[l[0]][l[1]]:3===l.length?i=t[l[0]][l[1]][l[3]]:4===l.length?i=t[l[0]][l[1]][l[3]][l[4]]:5===l.length&&(i=t[l[0]][l[1]][l[3]][l[4]][l[5]])}else i=0===p.length?t:t[p];if(typeof i===FUNCTION&&(i=i(c)),typeof i===UNDEFINED)return;if(0<u.length){var f=typeof i;if(f===STRING){var h=parseInt(u,10);isNaN(h)||(i=i.max(h+3,"..."))}else(f===NUMBER||util.isDate(i))&&(i=i.format(u))}i=i.toString().dollar(),e=e.replace(a,s?exports.htmlEncode(i):i)}return e},String.prototype.max=function(t,e){var r=this.toString();return e=e||"...",r.length>t?r.substring(0,t-e.length)+e:r},String.prototype.isJSON=function(){if(this.length<=1)return!1;var t=this[0],e=this[this.length-1];return'"'===t&&'"'===e||"["===t&&"]"===e||"{"===t&&"}"===e},String.prototype.isURL=function(){var t=this.toString();return!(t.length<=7)&&regexpUrl.test(t)},String.prototype.isEmail=function(){var t=this.toString();return!(t.length<=4)&&("."!==t[0]&&"."!==t[t.length-1]&&regexpMail.test(t))},String.prototype.parseInt=function(t){var e=0,r=this.toString();return e="0"===r.substring(0,1)?parseInt(r.replace(/\s/g,"").substring(1),10):parseInt(r.replace(/\s/g,""),10),isNaN(e)?t||0:e},String.prototype.parseFloat=function(t){var e=0,r=this.toString();return e="0"===r.substring(0,1)?parseFloat(r.replace(/\s/g,"").substring(1).replace(",",".")):parseFloat(r.replace(/\s/g,"").replace(",",".")),isNaN(e)?t||0:e},String.prototype.toUnicode=function(){for(var t="",e=this,r=0;r<e.length;++r)126<e.charCodeAt(r)||e.charCodeAt(r)<32?t+="\\u"+e.charCodeAt(r).hex(4):t+=e[r];return t},String.prototype.fromUnicode=function(){var t=this.replace(/\\u([\d\w]{4})/gi,function(t,e){return String.fromCharCode(parseInt(e,16))});return unescape(t)},String.prototype.sha1=function(){var t=crypto.createHash("sha1");return t.update(this.toString(),ENCODING),t.digest("hex")},String.prototype.md5=function(){var t=crypto.createHash("md5");return t.update(this.toString(),ENCODING),t.digest("hex")},String.prototype.encode=function(t,e){var r="0"+this.toString(),n=r.length,o=t.length,i=(r[n-1],exports.random(120)+40),a=n+i%o,s=[],p=0;s[0]=String.fromCharCode(i);for(var u=this.length+t.length,c=a-1;0<c;c--)p=r.charCodeAt(c%n),s[c]=String.fromCharCode(p^t.charCodeAt(c%o)^i);var l=new Buffer(u+"="+s.join(""),ENCODING).toString("base64").replace(/\//g,"-").replace(/\+/g,"_");return 0<(p=l.indexOf("="))?l.substring(0,p):l},String.prototype.decode=function(t){var e=this.toString().replace(/\-/g,"/").replace(/\_/g,"+"),r=e.length%4;if(0<r)for(var n=0;n<r;n++)e+="=";var o=(e=new Buffer(e,"base64").toString(ENCODING)).indexOf("=");if(-1===o)return"";var i=parseInt(e.substring(0,o),10);if(isNaN(i))return"";var a=(e=e.substring(o+1)).length,s=e.charCodeAt(0),p=t.length,u=[];for(n=a-s%p-1;0<n;n--)o=e.charCodeAt(n)^s^t.charCodeAt(n%p),u[n]=String.fromCharCode(o);var c=u.join("");return i!==c.length+t.length?"":c},String.prototype.findURL=function(){var t=[],e=this.match(LINK_1),r=this.match(LINK_2),n=0;if(null!==e){n=e.length;for(var o=0;o<n;o++)t.push(e[o])}if(null!==r){n=r.length;for(o=0;o<n;o++)t.push(r[o])}return t},String.prototype.findEmail=function(){var t=[],e=this.match(EMAIL);if(null===e)return[];for(var r=e.length,n=0;n<r;n++)t.push(e[n]);return t},String.prototype.base64ToFile=function(t,e){var r=this.toString(),n=r.indexOf(",");return-1===n?n=0:n++,e?fs.writeFile(t,r.substring(n),"base64",e):fs.writeFile(t,r.substring(n),"base64",exports.noop),this},String.prototype.base64ContentType=function(){var t=this.toString(),e=t.indexOf(";");return-1===e?"":t.substring(5,e)},String.prototype.removeDiacritics=function(){return exports.removeDiacritics(this)},String.prototype.indent=function(t,e){var r=this.toString();return new Array(t+1).join(e||" ")+r},String.prototype.isNumber=function(t){var e=this.toString();if(0===e.length)return!1;t=t||!1;for(var r=0;r<e.length;r++){var n=e.charCodeAt(r);if(!t||44!==n&&46!==n){if(n<48||57<n)return!1}else t=!1}return!0},String.prototype.padLeft=function(t,e){var r=this.toString();return new Array(Math.max(0,t-r.length+1)).join(e||" ")+r},String.prototype.padRight=function(t,e){var r=this.toString();return r+new Array(Math.max(0,t-r.length+1)).join(e||" ")},String.prototype.insert=function(t,e){var r=this.toString();return r.substring(0,t)+(e.toString()+r.substring(t))},String.prototype.dollar=function(){for(var t=this.toString(),e=t.indexOf("$",0);-1!==e;)"$"===t[e+1]&&(t=t.insert(e,"$")),e=t.indexOf("$",e+2);return t.toString()},String.prototype.link=function(t){t=t||60;for(var e=this.toString().trim().removeDiacritics().toLowerCase(),r=[],n=0;n<e.length;n++){var o=e[n],i=e.charCodeAt(n);if(r.length>=t)break;if(31<i&&i<48){if("-"===r[r.length-1])continue;r.push("-")}else 47<i&&i<58?r.push(o):94<i&&i<123&&r.push(o)}return r.join("")},String.prototype.pluralize=function(t,e,r,n){return this.toString().parseInt().pluralize(t,e,r,n)},String.prototype.isBoolean=function(){var t=this.toString().toLowerCase();return"true"===t||"false"===t},Number.prototype.floor=function(t){return Math.floor(this*Math.pow(10,t))/Math.pow(10,t)},Number.prototype.padLeft=function(t,e){return this.toString().padLeft(t,e||"0")},Number.prototype.padRight=function(t,e){return this.toString().padRight(t,e||"0")},Number.prototype.format=function(t){var e=0,r=this.toString(),n=0,o=0,i=0,a="";if(typeof t===STRING){for(var s=!1,p=0;p<t.length;p++){"#"===(h=t[p])&&(s?o++:n++),"."===h&&(s=!0)}var u=r,c="";if(-1!==(e=r.indexOf("."))&&(u=r.substring(0,e),c=r.substring(e+1)),u.length>n){i=u.length-n;var l="";for(p=0;p<i;p++)l+="#";t=l+t}u.length<n&&(u=u.padLeft(n," ")),c.length<o&&(c=c.padRight(o,"0")),c.length>o&&(c=c.substring(0,o)),s=!1;var f=!(e=0);for(p=0;p<t.length;p++){var h;if("#"===(h=t[p])){var g=s?c[e]:u[e];f&&(f=-1!==[","," "].indexOf(g)),f||(a+=g),e++}else{if(f)continue;"."===h&&(s=!0,e=0),a+=h}}return a}if(a="### ### ###",n=r.indexOf("."),0===(i=t||0)&&-1!=r&&(i=r.length-(n+1)),0<i){a+=".";for(p=0;p<i;p++)a+="#"}return this.format(a)},Number.prototype.pluralize=function(t,e,r,n){var o=this,i="",a=(i=0===o?t||"":1===o?e||"":1<o&&o<5?r||"":n).indexOf("#"),s=i.lastIndexOf("#");if(-1===a)return i;var p=i.substring(a,s+1);return o.format(p)+i.replace(p,"")},Number.prototype.hex=function(t){for(var e=this.toString(16).toUpperCase();e.length<t;)e="0"+e;return e},Number.prototype.condition=function(t,e){return(this%2==0?t:e)||""},Number.prototype.VAT=function(t,e,r){var n=typeof e;if(n===BOOLEAN){var o=r;r=e,n=typeof(e=o)}return n===UNDEFINED&&(e=2),typeof r===UNDEFINED&&(r=!0),0===t||0===this?this:r?(this/(t/100+1)).floor(e):(this*(t/100+1)).floor(e)},Number.prototype.discount=function(t,e){return typeof e===UNDEFINED&&(e=2),(this-this/100*t).floor(e)},Boolean.prototype.condition=function(t,e){return(this?t:e)||""},Array.prototype.take=function(t){for(var e=[],r=0;r<this.length;r++)if(e.push(this[r]),e.length>=t)return e;return e},Array.prototype.skip=function(t){for(var e=[],r=0;r<this.length;r++)t<=r&&e.push(this[r]);return e},Array.prototype.where=function(t){for(var e=[],r=0;r<this.length;r++)t.call(this,this[r],r)&&e.push(this[r]);return e},Array.prototype.find=function(t){for(var e=0;e<this.length;e++)if(t.call(this,this[e],e))return this[e];return null},Array.prototype.remove=function(t){for(var e=[],r=0;r<this.length;r++)t.call(this,this[r],r)||e.push(this[r]);return e},Array.prototype.random=function(){return this[exports.random(this.length-1)]},Array.prototype.randomize=function(){var n=(10*Math.floor(1e8*Math.random())).toString(),o=0,i=0;return this.sort(function(t,e){var r=n[o++];return typeof r===UNDEFINED&&(r=n[0],o=0),r<i?(i=r,-1):i===r?(i=r,0):(i=r,1)}),this},AsyncTask.prototype.run=function(){var e=this;try{e.isRunning=1,e.owner.tasksWaiting[e.name]=!0,e.owner.emit("begin",e.name);var t=e.owner.tasksTimeout[e.name];0<t&&(e.interval=setTimeout(e.timeout.bind(e),t)),e.fn(e.handlers.oncomplete)}catch(t){e.owner.emit("error",e.name,t),e.complete()}return e},AsyncTask.prototype.timeout=function(t){var e=this;return 0<t?(clearTimeout(e.interval),setTimeout(e.timeout.bind(e),t)):t<=0?(clearTimeout(e.interval),setTimeout(e.timeout.bind(e),t)):e.cancel(!0),e},AsyncTask.prototype.cancel=function(t){var e=this;e.isCanceled=!0,t?e.owner.emit("timeout",e.name):e.owner.emit("cancel",e.name),e.fn=null,e.cb=null},AsyncTask.prototype.complete=function(){var e=this,r=e.owner;if(e.isRunning=2,delete r.tasksPending[e.name],delete r.tasksWaiting[e.name],!e.isCanceled)try{r.emit("end",e.name),e.cb&&e.cb()}catch(t){r.emit("error",t,e.name)}return r.reload(),r.refresh(),r},Async.prototype={get count(){return this._count},get percentage(){return 100-Math.floor(100*this._count/this._max)}},Async.prototype.__proto__=new events.EventEmitter,Async.prototype.reload=function(){var t=this;return t.tasksAll=Object.keys(t.tasksPending),t.emit("percentage",t.percentage),t},Async.prototype.cancel=function(t){var e=this;if(typeof t===UNDEFINED){for(var r=0;r<e._count;r++)e.cancel(tasksAll[r]);return!0}var n=e.tasksPending[t];return!!n&&(delete e.tasksPending[t],delete e.tasksWaiting[t],n.cancel(),e.reload(),e.refresh(),!0)},Async.prototype.await=function(t,e,r){var n=this;return typeof t===FUNCTION&&(r=e,e=t,t=exports.GUID(6)),typeof n.tasksPending[t]===UNDEFINED&&(n.tasksPending[t]=new AsyncTask(n,t,e,r,null),n._max++,n.reload(),n.refresh(),!0)},Async.prototype.wait=function(t,e,r,n){var o=this;return typeof e===FUNCTION&&(n=r,r=e,e=t,t=exports.GUID(6)),typeof o.tasksPending[t]===UNDEFINED&&(o.tasksPending[t]=new AsyncTask(o,t,r,n,e),o._max++,o.reload(),o.refresh(),!0)},Async.prototype.complete=function(t){return this.run(t)},Async.prototype.run=function(t){return this._isRunning=!0,t&&this.onComplete.push(t),this.refresh(),this},Async.prototype.isRunning=function(t){if(!t)return this._isRunning;var e=this.tasksPending[t];return!!e&&1===e.isRunning},Async.prototype.isWaiting=function(t){var e=this.tasksPending[t];return!!e&&0===e.isRunning},Async.prototype.isPending=function(t){return!!this.tasksPending[t]},Async.prototype.timeout=function(t,e){return e<=0||typeof e===UNDEFINED?delete this.tasksTimeout[t]:this.tasksTimeout[t]=e,this},Async.prototype.refresh=function(t){var e=this;if(!e._isRunning)return e;e._count=e.tasksAll.length;for(var r=0;r<e._count;r++){var n=e.tasksPending[e.tasksAll[r]];0===n.isRunning&&(null!==n.waiting&&typeof e.tasksWaiting[n.waiting]!==UNDEFINED||n.run())}if(0===e._count){e._isRunning=!1,e.emit("complete"),e.emit("percentage",100),e._max=0;var o=e.onComplete,i=o.length;e.onComplete=[];for(r=0;r<i;r++)try{o[r]()}catch(t){e.emit("error",t)}}return e},exports.Async=Async,exports.async=Async,global.expression=expression,global.utils=exports;
//# sourceMappingURL=/sm/bcecbba2fe0638d7cd4e76bad09b2bd21636f84fabfafbb0e437270dafa3a7e7.map